<!-- Analytics Dashboard Component Template -->
<div class="analytics-container">
  <!-- Header -->
  <header class="analytics-header">
    <div class="header-content">
      <div class="title-section">
        <h1>📈 Advanced Analytics</h1>
        <p>Comprehensive insights, metrics, and benchmarking</p>
      </div>

      <div class="header-controls">
        <!-- Time Range Selector -->
        <div class="time-range-selector">
          <label for="timeRange">Time Range:</label>
          <select id="timeRange" [(ngModel)]="selectedTimeRange" (change)="onTimeRangeChange()">
            <option *ngFor="let range of timeRanges" [value]="range.value">
              {{ range.label }}
            </option>
          </select>
        </div>

        <!-- Refresh Button -->
        <button class="refresh-btn" (click)="refreshAnalytics()" [disabled]="isLoading">
          <span [class.spinning]="isLoading">🔄</span> Refresh
        </button>
      </div>
    </div>
  </header>

  <!-- Error Alert -->
  <div class="error-alert" *ngIf="error">
    <p>❌ {{ error }}</p>
    <button (click)="clearError()">✕</button>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="loading-spinner">🔄</div>
    <p>Loading analytics data...</p>
  </div>

  <!-- Analytics Content -->
  <div class="analytics-content" *ngIf="!isLoading && analyticsData">

    <!-- Key Metrics Overview -->
    <section class="metrics-overview">
      <h2>📊 Key Metrics</h2>

      <div class="metrics-grid">
        <!-- Query Metrics -->
        <div class="metric-card queries">
          <div class="metric-icon">🔍</div>
          <div class="metric-content">
            <h3>Total Queries</h3>
            <div class="metric-value">{{ formatNumber(analyticsData.queryMetrics.totalQueries) }}</div>
            <div class="metric-detail">
              {{ formatPercentage(analyticsData.queryMetrics.successRate) }} success rate
            </div>
          </div>
        </div>

        <!-- Response Time -->
        <div class="metric-card performance">
          <div class="metric-icon">⚡</div>
          <div class="metric-content">
            <h3>Avg Response Time</h3>
            <div class="metric-value">{{ analyticsData.queryMetrics.avgResponseTime }}ms</div>
            <div class="metric-detail">Processing speed</div>
          </div>
        </div>

        <!-- Documents -->
        <div class="metric-card documents">
          <div class="metric-icon">📄</div>
          <div class="metric-content">
            <h3>Documents Indexed</h3>
            <div class="metric-value">{{ formatNumber(analyticsData.documentMetrics.totalDocuments) }}</div>
            <div class="metric-detail">
              {{ formatNumber(analyticsData.documentMetrics.totalVectors) }} vectors
            </div>
          </div>
        </div>

        <!-- System Health -->
        <div class="metric-card system">
          <div class="metric-icon">{{ getSystemHealthIcon() }}</div>
          <div class="metric-content">
            <h3>System Health</h3>
            <div class="metric-value">{{ analyticsData.systemMetrics.systemHealth | titlecase }}</div>
            <div class="metric-detail">Overall status</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Data Visualization Section -->
    <section class="data-section">
      <h2>📈 Data Overview</h2>

      <div class="data-grid">
        <!-- Query Trends -->
        <div class="data-card">
          <h3>Query Activity Trends (Last {{ selectedTimeRange }})</h3>
          <div class="trend-summary">
            <div class="trend-item" *ngFor="let trend of analyticsData.queryMetrics.queryTrends.slice(-7)">
              <span class="trend-date">{{ trend.date | date:'short' }}</span>
              <span class="trend-count">{{ trend.count }} queries</span>
              <span class="trend-time">{{ trend.avgTime }}ms avg</span>
            </div>
          </div>
        </div>

        <!-- Document Types Distribution -->
        <div class="data-card">
          <h3>Document Types Distribution</h3>
          <div class="types-summary">
            <div class="type-item" *ngFor="let type of analyticsData.documentMetrics.documentTypes">
              <span class="type-name">{{ type.type }}</span>
              <div class="type-bar">
                <div
                  class="type-fill"
                  [style.width.%]="(type.count / analyticsData.documentMetrics.totalDocuments) * 100"
                ></div>
              </div>
              <span class="type-count">{{ type.count }}</span>
            </div>
          </div>
        </div>

        <!-- System Resource Usage -->
        <div class="data-card">
          <h3>System Resource Usage</h3>
          <div class="metrics-summary">
            <div class="metric-bar">
              <label>CPU Usage</label>
              <div class="bar">
                <div class="fill cpu" [style.width.%]="analyticsData.systemMetrics.cpuUsage"></div>
              </div>
              <span>{{ formatPercentage(analyticsData.systemMetrics.cpuUsage) }}</span>
            </div>
            <div class="metric-bar">
              <label>Memory Usage</label>
              <div class="bar">
                <div class="fill memory" [style.width.%]="analyticsData.systemMetrics.memoryUsage"></div>
              </div>
              <span>{{ formatPercentage(analyticsData.systemMetrics.memoryUsage) }}</span>
            </div>
            <div class="metric-bar">
              <label>Disk Usage</label>
              <div class="bar">
                <div class="fill disk" [style.width.%]="analyticsData.systemMetrics.diskUsage"></div>
              </div>
              <span>{{ formatPercentage(analyticsData.systemMetrics.diskUsage) }}</span>
            </div>
          </div>
        </div>

        <!-- Benchmark Performance (Enterprise only) -->
        <div class="data-card" *ngIf="hasEnterpriseAccess() && analyticsData.enterpriseMetrics">
          <h3>Benchmark Performance</h3>
          <div class="benchmark-summary">
            <div class="benchmark-item" *ngFor="let benchmark of analyticsData.enterpriseMetrics.benchmarkScores">
              <span class="benchmark-name">{{ benchmark.metric }}</span>
              <div class="benchmark-bars">
                <div class="benchmark-bar current">
                  <div class="benchmark-fill" [style.width.%]="benchmark.score"></div>
                </div>
                <div class="benchmark-bar target">
                  <div class="benchmark-fill" [style.width.%]="benchmark.target"></div>
                </div>
              </div>
              <div class="benchmark-values">
                <span class="current">{{ formatPercentage(benchmark.score) }}</span>
                <span class="target">Target: {{ formatPercentage(benchmark.target) }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Enterprise Analytics -->
    <section class="enterprise-section" *ngIf="hasEnterpriseAccess() && analyticsData.enterpriseMetrics">
      <h2>🚀 Enterprise Analytics</h2>

      <div class="enterprise-grid">
        <!-- Validation Results -->
        <div class="enterprise-card validation">
          <h3>🔍 Validation Results</h3>
          <div class="validation-list">
            <div
              class="validation-item"
              *ngFor="let result of analyticsData.enterpriseMetrics.validationResults"
            >
              <div class="validation-rule">{{ result.rule }}</div>
              <div class="validation-stats">
                <span class="passed">✅ {{ result.passed }}</span>
                <span class="failed">❌ {{ result.failed }}</span>
              </div>
              <div class="validation-rate">
                {{ formatPercentage(result.passed / (result.passed + result.failed) * 100) }}
              </div>
            </div>
          </div>
        </div>

        <!-- Source Accuracy -->
        <div class="enterprise-card accuracy">
          <h3>📊 Source Accuracy</h3>
          <div class="accuracy-list">
            <div
              class="accuracy-item"
              *ngFor="let source of analyticsData.enterpriseMetrics.sourceAccuracy"
            >
              <div class="source-name">{{ source.document }}</div>
              <div class="accuracy-bar">
                <div
                  class="accuracy-fill"
                  [style.width.%]="source.accuracy"
                  [class]="source.accuracy >= 95 ? 'excellent' : source.accuracy >= 90 ? 'good' : 'needs-improvement'"
                ></div>
              </div>
              <div class="accuracy-value">{{ formatPercentage(source.accuracy) }}</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Benchmark Results -->
    <section class="benchmark-section" *ngIf="hasEnterpriseAccess()">
      <h2>🎯 Benchmark Results</h2>

      <div class="benchmark-header">
        <div class="benchmark-info">
          <p>Run automated quality benchmarks to measure system performance</p>
        </div>
        <button
          class="benchmark-btn"
          (click)="runBenchmark()"
          [disabled]="isRunningBenchmark"
        >
          <span *ngIf="!isRunningBenchmark">🎯 Run Benchmark</span>
          <span *ngIf="isRunningBenchmark">🔄 Running...</span>
        </button>
      </div>

      <!-- Benchmark Results List -->
      <div class="benchmark-results" *ngIf="benchmarkResults.length > 0; else noBenchmarks">
        <div
          class="benchmark-item"
          *ngFor="let result of benchmarkResults"
        >
          <div class="benchmark-overview">
            <div class="benchmark-score">
              <div class="score-value">{{ formatPercentage(result.overallScore) }}</div>
              <div class="score-label">Overall Score</div>
            </div>

            <div class="benchmark-details">
              <div class="benchmark-timestamp">
                {{ result.timestamp | date:'short' }}
              </div>
              <div class="benchmark-status">
                {{ getBenchmarkStatusIcon(result.status) }} {{ result.status | titlecase }}
              </div>
            </div>
          </div>

          <!-- Category Scores -->
          <div class="category-scores">
            <div
              class="category-item"
              *ngFor="let category of Object.keys(result.categoryScores)"
            >
              <span class="category-name">{{ category }}:</span>
              <span class="category-score">{{ formatPercentage(result.categoryScores[category]) }}</span>
            </div>
          </div>

          <!-- Test Results -->
          <div class="test-results">
            <h4>Test Details:</h4>
            <div
              class="test-item"
              *ngFor="let test of result.testResults"
            >
              <span class="test-status">{{ test.passed ? '✅' : '❌' }}</span>
              <span class="test-name">{{ test.name }}</span>
              <span class="test-score">{{ formatPercentage(test.score) }}</span>
            </div>
          </div>
        </div>
      </div>

      <ng-template #noBenchmarks>
        <div class="no-benchmarks">
          <div class="no-benchmarks-icon">🎯</div>
          <h3>No Benchmark Results</h3>
          <p>Run your first benchmark to see quality metrics</p>
        </div>
      </ng-template>
    </section>

  </div>
</div>